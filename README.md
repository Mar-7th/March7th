# March7th

[![OneBot](https://img.shields.io/badge/OneBot-V11-444?style=for-the-badge&labelColor=ddd&logo=data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABABAMAAABYR2ztAAAAIVBMVEUAAAAAAAADAwMHBwceHh4UFBQNDQ0ZGRkoKCgvLy8iIiLWSdWYAAAAAXRSTlMAQObYZgAAAQVJREFUSMftlM0RgjAQhV+0ATYK6i1Xb+iMd0qgBEqgBEuwBOxU2QDKsjvojQPvkJ/ZL5sXkgWrFirK4MibYUdE3OR2nEpuKz1/q8CdNxNQgthZCXYVLjyoDQftaKuniHHWRnPh2GCUetR2/9HsMAXyUT4/3UHwtQT2AggSCGKeSAsFnxBIOuAggdh3AKTL7pDuCyABcMb0aQP7aM4AnAbc/wHwA5D2wDHTTe56gIIOUA/4YYV2e1sg713PXdZJAuncdZMAGkAukU9OAn40O849+0ornPwT93rphWF0mgAbauUrEOthlX8Zu7P5A6kZyKCJy75hhw1Mgr9RAUvX7A3csGqZegEdniCx30c3agAAAABJRU5ErkJggg==)](https://onebot.dev/)
[![OneBot](https://img.shields.io/badge/OneBot-V12-444?style=for-the-badge&labelColor=ddd&logo=data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABABAMAAABYR2ztAAAAIVBMVEUAAAAAAAADAwMHBwceHh4UFBQNDQ0ZGRkoKCgvLy8iIiLWSdWYAAAAAXRSTlMAQObYZgAAAQVJREFUSMftlM0RgjAQhV+0ATYK6i1Xb+iMd0qgBEqgBEuwBOxU2QDKsjvojQPvkJ/ZL5sXkgWrFirK4MibYUdE3OR2nEpuKz1/q8CdNxNQgthZCXYVLjyoDQftaKuniHHWRnPh2GCUetR2/9HsMAXyUT4/3UHwtQT2AggSCGKeSAsFnxBIOuAggdh3AKTL7pDuCyABcMb0aQP7aM4AnAbc/wHwA5D2wDHTTe56gIIOUA/4YYV2e1sg713PXdZJAuncdZMAGkAukU9OAn40O849+0ornPwT93rphWF0mgAbauUrEOthlX8Zu7P5A6kZyKCJy75hhw1Mgr9RAUvX7A3csGqZegEdniCx30c3agAAAABJRU5ErkJggg==)](https://onebot.dev/)
[![QQ](https://img.shields.io/badge/QQ-Bot-444?style=for-the-badge&labelColor=ddd&logo=data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMTIuODIgMTMwLjg5Ij48ZyBkYXRhLW5hbWU9IuWbvuWxgiAyIj48ZyBkYXRhLW5hbWU9IuWbvuWxgiAxIj48cGF0aCBkPSJNNTUuNjMgMTMwLjhjLTcgMC0xMy45LjA4LTIwLjg2IDAtMTkuMTUtLjI1LTMxLjcxLTExLjQtMzQuMjItMzAuMy00LjA3LTMwLjY2IDE0LjkzLTU5LjIgNDQuODMtNjYuNjQgMi0uNTEgNS4yMS0uMzEgNS4yMS0xLjYzIDAtMi4xMy4xNC0yLjEzLjE0LTUuNTcgMC0uODktMS4zLTEuNDYtMi4yMi0yLjMxLTYuNzMtNi4yMy03LjY3LTEzLjQxLTEtMjAuMTggNS40LTUuNTIgMTEuODctNS40IDE3LjgtLjU5IDYuNDkgNS4yNiA2LjMxIDEzLjA4LS44NiAyMS0uNjguNzQtMS43OCAxLjYtMS43OCAyLjY3djQuMjFjMCAxLjM1IDIuMiAxLjYyIDQuNzkgMi4zNSAzMS4wOSA4LjY1IDQ4LjE3IDM0LjEzIDQ1IDY2LjM3LTEuNzYgMTguMTUtMTQuNTYgMzAuMjMtMzIuNyAzMC42My04LjAyLjE5LTE2LjA3LS4wMS0yNC4xMy0uMDF6IiBmaWxsPSIjMDI5OWZlIi8+PHBhdGggZD0iTTMxLjQ2IDExOC4zOGMtMTAuNS0uNjktMTYuOC02Ljg2LTE4LjM4LTE3LjI3LTMtMTkuNDIgMi43OC0zNS44NiAxOC40Ni00Ny44MyAxNC4xNi0xMC44IDI5Ljg3LTEyIDQ1LjM4LTMuMTkgMTcuMjUgOS44NCAyNC41OSAyNS44MSAyNCA0NS4yOS0uNDkgMTUuOS04LjQyIDIzLjE0LTI0LjM4IDIzLjUtNi41OS4xNC0xMy4xOSAwLTE5Ljc5IDAiIGZpbGw9IiNmZWZlZmUiLz48cGF0aCBkPSJNNDYuMDUgNzkuNThjLjA5IDUgLjIzIDkuODItNyA5Ljc3LTcuODItLjA2LTYuMS01LjY5LTYuMjQtMTAuMTktLjE1LTQuODItLjczLTEwIDYuNzMtOS44NHM2LjM3IDUuNTUgNi41MSAxMC4yNnoiIGZpbGw9IiMxMDlmZmUiLz48cGF0aCBkPSJNODAuMjcgNzkuMjdjLS41MyAzLjkxIDEuNzUgOS42NC01Ljg4IDEwLTcuNDcuMzctNi44MS00LjgyLTYuNjEtOS41LjItNC4zMi0xLjgzLTEwIDUuNzgtMTAuNDJzNi41OSA0Ljg5IDYuNzEgOS45MnoiIGZpbGw9IiMwODljZmUiLz48L2c+PC9nPjwvc3ZnPg==)](https://bot.q.qq.com/wiki/)

[![QQ Chat Grop](https://img.shields.io/badge/QQ%E7%BE%A4-942679013-orange?style=for-the-badge)](https://qm.qq.com/q/SbY6EJqEM2)

崩坏：星穹铁道多功能机器人（开发中），目前支持账号绑定、信息查询、Wiki 查询等功能。

本项目基于 Nonebot2，通过 [nonebot-plugin-send-anything-anywhere](https://github.com/felinae98/nonebot-plugin-send-anything-anywhere) 实现对 OneBot v11, OneBot v12, QQ, 开黑啦, Telegram, Feishu, Red 适配器的支持；使用 [nonebot-plugin-orm](https://github.com/nonebot/plugin-orm) 进行数据库管理。

## 安装

### 下载源码

使用 `git clone https://github.com/Mar-7th/March7th.git` 或 [下载压缩包](https://github.com/Mar-7th/March7th/archive/refs/heads/master.zip) 并解压，进入工程目录。

### 安装依赖

#### 使用 Poetry 安装

如果未安装 `poetry`，先参考 [文档](https://python-poetry.org/docs/#installation) 安装。

在项目根目录使用 `poetry install` 安装项目依赖。

运行 `poetry shell` 进入虚拟环境，继续后续操作。

#### 使用 pip 安装

在项目根目录使用 `python -m venv .venv` 创建虚拟环境。

Linux / MacOS 使用命令 `source .venv/bin/activate`，Windows 使用命令 `.venv\Scripts\activate` 激活虚拟环境。

使用 `pip install -r requirements.txt` 安装项目依赖，此方式默认使用 TUNA 镜像源。

### Bot 配置

配置协议端，具体参考 [协议端配置](#协议端配置)。

配置运行环境参数，如超级用户账号、bot 昵称等（可复制 `.env.dev` 文件到 `.env.prod` 后根据注释提示填入参数）。

使用 `nb run` 运行 Bot 程序。

给聊天机器人发送命令 `srhelp` 即可查看命令列表，如果配置的命令前缀不包含 `""`，则需要加上命令前缀。

## 常见问题

### 安装其他商店插件

机器人支持使用 `nb-cli` 安装其他 NoneBot 应用商店中的插件。

机器人本体兼容了 Pydantic v1 与 v2 版本，如安装其他插件后遇到 Pydantic 相关警告或报错，请考虑降级 Pydantic 至 v1 版本：

```bash
pip install --force-reinstall 'pydantic~=1.10'
```

### 添加公共 cookie

添加公共 cookie 后，用户可以无需绑定 cookie 就能使用 `srinfo`。

添加公共 cookie 需要超级用户权限（在 `.env.prod` 中配置），发送 `srpck [cookie]`，将 `[cookie]` 替换为实际的 cookie 内容。

### 协议端配置

#### QQ 机器人

需要在项目根目录运行命令 `nb adapter install nonebot-adapter-qq`。

然后参考 [QQ 适配器文档](https://github.com/nonebot/adapter-qq) 进行适配器配置。

#### Lagrange.OneBot

参考 [Lagrange.OneBot 文档](https://lagrangedev.github.io/Lagrange.Doc/Lagrange.OneBot/) 进行协议端安装与配置。

然后参考 [OneBot V11 适配器文档](https://onebot.adapters.nonebot.dev/docs/guide/setup#onebot-v11) 进行适配器配置。

#### OpenShamrock

参考 [OpenShamrock 文档](https://whitechi73.github.io/OpenShamrock/guide/) 进行协议端安装与配置。

然后参考 [OneBot V11 适配器文档](https://onebot.adapters.nonebot.dev/docs/guide/setup#onebot-v11) 进行适配器配置。

#### LLOneBot

参考 [LLOneBot 文档](https://llonebot.github.io/zh-CN/guide/getting-started) 进行协议端安装与配置。

然后参考 [OneBot V11 适配器文档](https://onebot.adapters.nonebot.dev/docs/guide/setup#onebot-v11) 进行适配器配置。

#### Chronocat

此方式仅供存量旧版本用户使用。

参考 [Chronocat 文档](https://chronocat.vercel.app/install/) 进行协议端安装与配置。

然后参考 [Red 适配器文档](https://github.com/nonebot/adapter-red) 进行适配器配置。

#### go-cqhttp

此方式不推荐新搭建 Bot 使用，请参考 [迁移建议](https://github.com/Mrs4s/go-cqhttp/issues/2471)。

在项目根目录运行命令 `nb plugin install nonebot-plugin-gocqhttp`。

运行 Bot 程序后根据提示在网页端进行账号配置。

## 链接

本项目参考以下项目完成：

| 项目 / 插件名                                                                              | 描述                                            | 使用方式            |
| ------------------------------------------------------------------------------------------ | ----------------------------------------------- | ------------------- |
| [`Mar-7th/StarRailRes`](https://github.com/Mar-7th/StarRailRes)                            | 崩坏：星穹铁道资源库                            | Icon 及攻略资源     |
| [`CMHopeSunshine/LittlePaimon`](https://github.com/CMHopeSunshine/LittlePaimon)            | 小派蒙！基于 Nonebot2 的原神 QQ 机器人          | 米游社 API 接口参考 |
| [`Genshin-bots/gsuid_core`](https://github.com/Genshin-bots/gsuid_core)                    | GsCore 插件核心部分                             | 部分功能实现参考    |
| [`MeetWq/pil-utils`](https://github.com/MeetWq/pil-utils)                                  | A simple PIL wrapper and text-to-image tool     | PIL 绘图辅助工具    |
| [`nonebot/nonebot2`](https://github.com/nonebot/nonebot2)                                  | 跨平台 Python 异步聊天机器人框架                | Bot 框架            |
| [`nonebot_plugin_saa`](https://github.com/felinae98/nonebot-plugin-send-anything-anywhere) | 一个帮助处理不同 Adapter 消息的适配和发送的插件 | Bot 消息发送实现    |
| [`nonebot_plugin_orm`](https://github.com/nonebot/plugin-orm)                              | SQLAlchemy support for NoneBot2                 | Bot 数据库管理      |
